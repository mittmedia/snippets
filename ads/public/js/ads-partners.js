// Generated by CoffeeScript 1.9.1
(function() {
  var extend = function(child, parent) { for (var key in parent) { if (hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; },
    hasProp = {}.hasOwnProperty;

  new ((function(superClass) {
    extend(_Class, superClass);

    function _Class() {
      return _Class.__super__.constructor.apply(this, arguments);
    }

    _Class.prototype.local_attributes = {
      name: "admeta_handler",
      view: 'header_view',
      collection: 'header_collection',
      dependencies: ['site_module'],
      ads_count: 1,
      processed_ads: [],
      external_script_url: 'http://s.atemda.com/Admeta.js',
      placements: {
        desktop: {
          panorama_wide: {
            width: 1250,
            height: 600,
            rank: 1
          },
          panorama: {
            width: 980,
            height: 240,
            rank: 1
          },
          box_wide: {
            width: 250,
            height: 800,
            rank: 1
          },
          box: {
            width: 200,
            height: 300,
            rank: 1
          }
        },
        tablet: {
          panorama: {
            width: 1250,
            height: 600,
            rank: 1
          },
          box_wide: {
            width: 250,
            height: 800,
            rank: 1
          },
          box: {
            width: 200,
            height: 300,
            rank: 1
          }
        },
        mobile: {
          box: {
            width: 320,
            height: 480,
            rank: 1
          }
        }
      },
      categories: ['Start', 'Ettan', 'Sport', 'Ekonomi', 'Kulturnoje', 'Nyheter', 'Ovrigt', 'Fotboll', 'Ishockey', 'Modo', 'Leksands', 'Brynas', 'Skidor', 'Musik', 'Konst', 'Film', 'Jobb', 'Pengar']
    };

    _Class.prototype.on_load = function() {};

    _Class.prototype.process_ad = function(id) {
      var element, processed_ads;
      element = document.getElementById(id);
      processed_ads = this.get('processed_ads');
      if (!(processed_ads.indexOf(id) >= 0)) {
        processed_ads.push(id);
        this.set('processed_ads', processed_ads);
        setTimeout(((function(_this) {
          return function() {
            return _this.prepare_adm_pl(id, element);
          };
        })(this)), 20);
      }
    };

    _Class.prototype.prepare_adm_pl = function(id, e) {
      var ADM_PL, ad_format, ad_size, device, page, placements;
      placements = this.get('placements');
      device = window.sparrow.models.site_module.get('current_device');
      ad_format = this.get_ad_format(e);
      ad_size = placements[device][ad_format];
      page = this.get_page();
      window.ADM_PL = ADM_PL = {
        centerImages: true,
        tp: 'spt',
        pbId: 22,
        protect: true,
        defLoad: true,
        tagId: id,
        site: window.sparrow.models.site_module.get('site_id'),
        page: page + (" " + (this.get('ads_count'))),
        rank: placements[device][ad_format].rank,
        width: ad_size.width,
        height: ad_size.height
      };
      this.set_rank(device, ad_format);
      if (window.Admeta) {
        window.Admeta.processImpressions();
      }
      this.set('ads_count', this.get('ads_count') + 1);
    };

    _Class.prototype.get_ad_format = function(element) {
      if (window.sparrow.models.site_module.get('current_device') === "mobile") {
        return "box";
      }
      if (element.offsetWidth > 1100) {
        return "panorama_wide";
      }
      if (element.offsetWidth > 400) {
        return "panorama";
      }
      return "box_wide";
    };

    _Class.prototype.get_page = function() {
      var categories, category, compare_categories, i, j, k, keyword, len, len1, ref;
      if (!window.content_keywords) {
        return "Ovrigt";
      }
      categories = this.get('categories');
      compare_categories = _.map(categories, function(category) {
        return category.toLowerCase();
      });
      ref = window.content_keywords;
      for (j = 0, len = ref.length; j < len; j++) {
        keyword = ref[j];
        for (i = k = 0, len1 = compare_categories.length; k < len1; i = ++k) {
          category = compare_categories[i];
          if (category.indexOf(keyword) > -1 || keyword.indexOf(category) > -1) {
            if (categories[i] === "Ettan") {
              return "Start";
            }
            if (categories[i] === "Fotboll" || categories[i] === "Ishockey" || categories[i] === "Skidor") {
              return "Sport";
            }
            if (categories[i] === "Modo" || categories[i] === "Leksands" || categories[i] === "Brynas") {
              return "Sport";
            }
            if (categories[i] === "Musik" || categories[i] === "Film" || categories[i] === "Konst") {
              return "Kulturnoje";
            }
            if (categories[i] === "Jobb" || categories[i] === "Pengar") {
              return "Ekonomi";
            }
            return categories[i];
          }
        }
      }
      return "Nyheter";
    };

    _Class.prototype.set_rank = function(device, ad_format) {
      var placements;
      placements = this.get('placements');
      placements[device][ad_format].rank += 1;
      this.set('placements', placements);
    };

    return _Class;

  })(sparrow.BaseModule));

  new ((function(superClass) {
    extend(_Class, superClass);

    function _Class() {
      return _Class.__super__.constructor.apply(this, arguments);
    }

    _Class.prototype.local_attributes = {
      name: "emediate_handler",
      view: 'header_view',
      collection: 'header_collection',
      dependencies: ['site_module'],
      external_script_url: 'http://eas.mediekompaniet.com/EAS_tag.1.0.js'
    };

    _Class.prototype.on_load = function() {};

    _Class.prototype.process_ad = function(id, payload) {
      var cu, tmp;
      tmp = document.createElement('DIV');
      tmp.innerHTML = payload;
      tmp = tmp.getElementsByTagName('DIV')[0] || null;
      cu = tmp.getAttribute("data-order-id");
      this.prepare_emediate(id, cu);
    };

    _Class.prototype.prepare_emediate = function(id, cu) {
      var device, east_ecid;
      device = window.sparrow.models.site_module.get('current_device');
      if (id === "emediate_d_mk468") {
        east_ecid = "EASTecid=203|214|";
      }
      EAS_load_fif(id, "/EAS_fif.html", "http://eas4.emediate.eu/eas?cu=" + cu + ";cre=mu;js=y;target=_blank;" + (east_ecid || ''), 0, 600);
    };

    return _Class;

  })(sparrow.BaseModule));

  new ((function(superClass) {
    extend(_Class, superClass);

    function _Class() {
      return _Class.__super__.constructor.apply(this, arguments);
    }

    _Class.prototype.local_attributes = {
      name: "widespace_handler",
      view: 'header_view',
      collection: 'header_collection',
      dependencies: ['site_module']
    };

    _Class.prototype.on_load = function() {};

    _Class.prototype.process_ad = function(id, payload) {
      var cu, tmp;
      tmp = document.createElement('DIV');
      tmp.innerHTML = payload;
      tmp = tmp.getElementsByTagName('DIV')[0] || null;
      cu = tmp.getAttribute("data-order-id");
      this.load_ad(id, cu);
    };

    _Class.prototype.load_ad = function(id, cu) {
      var el;
      el = document.getElementById(id);
      el.innerHTML = "<iframe data-src='/widespace_fif.html?cu=" + cu + "' scrolling='no' frameborder='0' style='margin: 0px auto; border-width: 0px; padding: 0px;'></iframe>";
      IframeFixer.enqueueIframe(el);
    };

    return _Class;

  })(sparrow.BaseModule));

}).call(this);
